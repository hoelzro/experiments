<html>
  <head>
    <title>React Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script type='text/javascript' src='https://unpkg.com/babel-standalone@6/babel.min.js'>
    </script>
    <script type='text/babel'>
      class Countdown extends React.Component {
        constructor(props) {
          super(props);
          this.interval = null;
          this.state = {
            state: 'stopped',
            secondsRemaining: 0,
            secondsTotal: null,
          };
        }

        handleCountdownSecondsChanged(e) {
          this.setState({
            secondsTotal: parseInt(e.target.value),
          });
        }

        handleTick() {
          if(this.state.secondsRemaining <= 0) {
            this.pauseTimer();
            this.setState({
              state: 'firing',
            });
          } else {
            this.setState((state, _) => ({
              secondsRemaining: state.secondsRemaining - 1,
            }));
          }
        }

        startTimer() {
          this.setState((state, props) => ({
            secondsRemaining: state.secondsTotal,
          }));

          this.resumeTimer();
        }

        resumeTimer() {
          this.setState({
            state: 'running',
          });

          this.interval = setInterval(this.handleTick.bind(this), 1000);
        }

        pauseTimer() {
          clearInterval(this.interval);
          this.interval = null;
        }

        handleStartPause() {
          switch(this.state.state) {
            case 'stopped':
              this.startTimer();
              break;
            case 'paused':
              this.resumeTimer();
              break;
            case 'running':
              this.pauseTimer();
              break;
            // otherwise (firing), do nothing
          }
        }

        handleStop() {
          if(this.state.state == 'running') {
            this.pauseTimer();
          }

          this.setState({
            state: 'stopped',
          });
        }

        render() {
          function handleSubmit(e) {
            e.preventDefault();
          }

          return (
            <div>
              <p>Countdown: </p>
              <form onSubmit={handleSubmit}>
                <label htmlFor='countdown_seconds'></label>
                <input type='number' name='countdown_seconds' onInput={this.handleCountdownSecondsChanged.bind(this)} />

                <br />

                <button onClick={this.handleStartPause.bind(this)}>Start/Pause</button>
                <button onClick={this.handleStop.bind(this)}>Stop</button>
              </form>
            </div>
          );
        }
      }

      function go() {
        let root = ReactDOM.createRoot(document.getElementById('react-root'));
        root.render(<Countdown />);
      }
    </script>
  </head>
  <body>
    <div id='react-root'>
    </div>

    <script type='text/javascript'>
      window.addEventListener('DOMContentLoaded', function() {
        go();
      });
    </script>
  </body>
</html>
